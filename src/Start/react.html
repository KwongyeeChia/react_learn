<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>
<body>
  <div class="wrapper">
    <!-- <button class="like-button">
      <span class="like-text">èµ</span>
      ğŸ‰
    </button> -->
  </div>
</body>
  <script>
    // ----------------------å…¬å…±æ–¹æ³•--------------------------
    // åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œæ¥æ”¶å­—ç¬¦ä¸²è¿”å›DOMï¼Œåªæœ‰DOMç»“æ„æ‰èƒ½æœ‰äº‹ä»¶
    const createDOMFromString = (domString)=>{
      let div = document.createElement('div')
      div.innerHTML = domString
      return div
    }
    // è·å–æ ¹å…ƒç´ å®¹å™¨ï¼Œç”¨äºæŒ‚è½½
    let wrapper = document.querySelector('.wrapper')
    // -------------------------------------------------------
    // ç¬¬ä¸€é˜¶æ®µ å®ç°åŸºç¡€ç»“æ„ï¼Œæ·»åŠ äº‹ä»¶
    // let button = document.querySelector('.like-button')
    // let buttonText = document.querySelector('.like-text')
    // let isLiked = false
    // button.addEventListener('click',function(){
    //   isLiked = !isLiked
    //   buttonText.innerHTML = isLiked ? 'ç‚¹èµ':'å–æ¶ˆ'
    // }, false)
    // ------------------------------------------------------
    // ç¬¬äºŒé˜¶æ®µ å¤ç”¨ç»“æ„ï¼Œæ·»åŠ å¯¹åº”äº‹ä»¶
    // class LikeButton {
    //   constructor() {
    //     this.state = {
    //       isLiked: false
    //     }
    //   }
    //   changeLikeText() {
    //     const likeText = this.el.querySelector('.like-text')
    //     this.state.isLiked = !this.state.isLiked
    //     likeText.innerHTML = this.state.isLiked ? 'å–æ¶ˆ':'ç‚¹èµ'
    //   }
    //   render() {
    //     this.el = createDOMFromString(`
    //       <button class="like-button">
    //         <span class="like-text">èµ</span>
    //         <span>ğŸ‘</span>
    //       </button>
    //     `)
    //     this.el.addEventListener('click', this.changeLikeText.bind(this) , false)
    //     return this.el
    //   }
    // }
    // let button1 = new LikeButton()
    // wrapper.appendChild(button1.render())
    // let button2 = new LikeButton()
    // wrapper.appendChild(button2.render())
    // -----------------------------------------------------------
    // ç¬¬ä¸‰é˜¶æ®µ å‡å°‘æ‰‹åŠ¨ç»´æŠ¤DOMæ“ä½œ,é€šè¿‡çŠ¶æ€å»é©±åŠ¨DOMçš„æ›´æ–°
    // class LikeButton {
    //   constructor() {
    //     this.state = {
    //       isLiked: false
    //     }
    //   }
    //   setState(state) {
    //     const oldEl = this.el
    //     this.state = state
    //     this.el = this.render()
    //     if (this.onStateChange) this.onStateChange(oldEl, this.el) 
    //   }
    //   changeLikeText() {
    //     this.setState({
    //       isLiked: !this.state.isLiked
    //     })
    //   }
    //   render() {
    //     this.el = createDOMFromString(`
    //       <button class="like-button">
    //         <span class="like-text">${this.state.isLiked ? 'å–æ¶ˆ':'ç‚¹èµ'}</span>
    //         <span>ğŸ‘</span>
    //       </button>
    //     `)
    //     this.el.addEventListener('click', this.changeLikeText.bind(this) , false)
    //     return this.el
    //   }
    // }
    // let likeButton = new LikeButton()
    // wrapper.append(likeButton.render())
    // likeButton.onStateChange = (oldEl, newEl) => {
    //   wrapper.insertBefore(newEl, oldEl)
    //   wrapper.removeChild(oldEl)
    // }
    // --------------------------------------------------------------
    // ç¬¬å››é˜¶æ®µ åˆ›å»ºä¸€ä¸ªComponentå…¬å…±ç±» ç”¨äºåˆ›å»ºæ›´å¤šçš„ç»„ä»¶
    class Component {
      constructor(props = {}) {
        this.props = props
      }
      setState(state) {
        const oldEl = this.el
        this.state = state
        this.el = this._renderDOM()
        if ( this.onStateChange ) this.onStateChange(oldEl,this.el)
      }
      _renderDOM() {
        this.el = createDOMFromString(this.render())
        if (this.onClick) {
          this.el.addEventListener('click', this.onClick.bind(this), false)
        }
        return this.el
      }
    }
    // ç»§æ‰¿Componentç±» åˆ›å»ºLikeButtonç»„ä»¶
    class LikeButton extends Component {
      constructor(props) {
        super(props)
        this.state = { isLiked: false }
      }
      onClick() {
        this.setState({
          isLiked: !this.state.isLiked
        })
      }
      render() {
        return `
          <button class="like-button" style="background-color: ${this.props.bgColor}">
            <span class="like-text">${this.state.isLiked ? 'å–æ¶ˆ':'ç‚¹èµ'}</span>
            <span>ğŸ‘</span>
          </button>
        `
      }
    }
    // æŒ‚è½½å‡½æ•°
    const mount = (component, wrapper) => {
      console.log('component', component, 'wrapper', wrapper)
      wrapper.appendChild(component._renderDOM())
      component.onStateChange = (oldEl, newEl) => {
        wrapper.insertBefore(newEl, oldEl)
        wrapper.removeChild(oldEl)
      }
    }
    // å®ä¾‹åŒ–
    mount(new LikeButton({bgColor: 'red'}), wrapper)
  </script>
</html>